letrec loop ch fun =
  let (v, ch) = rd ch in
  let! f = fun in
    f v; loop ch fun