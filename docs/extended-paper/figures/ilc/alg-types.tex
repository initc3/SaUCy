\begin{figure*}[h]
%\small
\centering
\judgbox{\Delta_{\emph{in}} ; \Gamma |- e : U -| \Delta_{\emph{out}}}{~~Under input contexts $\Delta_{\emph{in}}$ and
  $\Gamma$, expression~$e$ has type $U$ and output context $\Delta_{\emph{out}}$.}
\begin{mathpar}
\Infer{uvar}
{}
{\Delta; \Gamma, x : A |- x : A -| \Delta}
%
\and
%
\Infer{avar}
{ }
{\Delta, x : X; \Gamma |- x : X -| \Delta}
%
\and
%
\Infer{unit}
{ }
{\Delta ; \Gamma |- \eUnit : \tyUnit -| \Delta}
%
\and
%
\Infer{upair}
{\Delta_1; \Gamma |- e_1 : A_1 -| \Delta_2\\\\
\Delta_2; \Gamma |- e_2 : A_2 -| \Delta_3}
{\Delta_1; \Gamma |- \ePair{e_1}{e_2}{\infty} : \tyProdd{}{A_1}{A_2} -| \Delta_3}
%
\and
%
\Infer{spair}
{\Delta_1; \Gamma |- e_1 : S_1 -| \Delta_2\\\\
\Delta_2; \Gamma |- e_2 : S_2 -| \Delta_3}
{\Delta_1; \Gamma |- \ePair{e_1}{e_2}{\wm} : \tyProdd{}{S_1}{S_2} -| \Delta_3}
%
\and
%
\Infer{apair}
{\Delta_1; \Gamma |- e_1 : X_1 -| \Delta_2\\\\
\Delta_2; \Gamma |- e_2 : X_2 -| \Delta_3}
{\Delta_1; \Gamma |- \ePair{e_1}{e_2}{1} : \tyTensor{X_1}{X_2} -| \Delta_3}
%
\and
%
\Infer{uinj}
{i \in \{1, 2\}\\\\
\Delta_1; \Gamma |- e : A_i -| \Delta_2}
{\Delta_1 ; \Gamma |- \eInjj{\infty}{i}{e} : \tySum{A_1}{}{A_2} -| \Delta_2}
%
\and
%
\Infer{sinj}
{i \in \{1, 2\}\\\\
\Delta_1; \Gamma |- e : S_i -| \Delta_2}
{\Delta_1 ; \Gamma |- \eInjj{\wm}{i}{e} : \tySum{S_1}{}{S_2} -| \Delta_2}
%
\and
%
\Infer{ainj}
{i \in \{1, 2\}\\\\
\Delta_1; \Gamma |- e : X_i -| \Delta_2}
{\Delta_1 ; \Gamma |- \eInjj{1}{i}{e} : \tyOplus{X_1}{X_2} -| \Delta_2}
%
\and
%
\Infer{usplit}
{\Delta_1; \Gamma |- e_1 : \tyProdd{}{A_1}{A_2} -| \Delta_2\\\\
\Delta_2; \Gamma,x_1:A_1, x_2: A_2 |- e : U -| \Delta_3}
{\Delta_1; \Gamma |- \eSplitt{\infty}{e_1}{x_1}{x_2}{e_2} : U -| \Delta_3}
%
\and
%
\Infer{ssplit}
{\Delta_1; \Gamma |- e_1 : \tyProdd{}{S_1}{S_2} -| \Delta_2\\\\
\Delta_2; \Gamma,x_1:S_1, x_2: S_2 |- e : U -| \Delta_3}
{\Delta_1; \Gamma |- \eSplitt{\wm}{e_1}{x_1}{x_2}{e_2} : U -| \Delta_3}
%
\and
%
\Infer{asplit}
{\Delta_1; \Gamma |- e_1 : \tyTensor{X_1}{X_2} -| \Delta_2\\\\
\Delta_2,x_1:X_1, x_2: X_2; \Gamma |- e : U -| \Delta_3}
{\Delta_1; \Gamma |- \eSplitt{1}{e_1}{x_1}{x_2}{e_2} : U -| \Delta_3 \div (x_1:X_1, x_2: X_2)}
%
\and
%  
\Infer{ucase}
{\Delta_1; \Gamma |- e : \tySum{A_1}{}{A_2} -| \Delta_2\\\\
\Delta_2; \Gamma,x_1:A_1 |- e_1 : U -| \Delta_3\\\\
\Delta_2; \Gamma,x_2:A_2 |- e_2 : U -| \Delta_3}
{\Delta_1; \Gamma |- \eCase{\infty}{e}{x_1}{e_1}{x_2}{e_2} : U -| \Delta_3}
%
\and
%
\Infer{scase}
{\Delta_1; \Gamma |- e : \tySum{S_1}{}{S_2} -| \Delta_2\\\\
\Delta_2; \Gamma,x_1:S_1 |- e_1 : U -| \Delta_3\\\\
\Delta_2; \Gamma,x_2:S_2 |- e_2 : U -| \Delta_3}
{\Delta_1; \Gamma |- \eCase{\wm}{e}{x_1}{e_1}{x_2}{e_2} : U -| \Delta_3}
%
\and
%  
\Infer{acase}
{\Delta_1; \Gamma |- e : \tyOplus{X_1}{X_2} -| \Delta_2\\\\
\Delta_2,x_1:X_1; \Gamma |- e_1 : U -| \Delta_3\\
\Delta_2,x_2:X_2; \Gamma |- e_2 : U -| \Delta_3}
{\Delta_1; \Gamma |- \eCase{1}{e}{x_1}{e_1}{x_2}{e_2} : U -| \Delta_3 \div (x_1:X_1, x_2:X_2)}
%
\and
%
\Infer{uabs}
{\emptyctxt ; \Gamma, x:A |- e : U -| \emptyctxt}
{\Delta ; \Gamma |- \eLamm{\infty}{x}{e} : \tyArr{A}{\infty}{U} -| \Delta}
%
\and
%
\Infer{wabs}
{\wrtok ; \Gamma, x:A |- e : U -| \emptyctxt}
{\Delta ; \Gamma |- \eLamm{\wm}{x}{e} : \tyArr{A}{\wm}{U} -| \Delta}
%
\and
%
\Infer{aabs}
{\Delta_1,x : X; \Gamma |- e : U -| \Delta_2}
{\Delta_1 ; \Gamma |- \eLamm{1}{x}{e} : \tyArr{X}{1}{U} -| \Delta_2 \div (x:X)}
%
\and
%
\Infer{uapp}
{\Delta_1; \Gamma |- e_2 : A -| \Delta_2\\\\
\Delta_2; \Gamma |- e_1 : \tyArr{A}{\infty}{U} -| \Delta_3}
{\Delta_1; \Gamma |- \eApp{e_1}{e_2}{\infty} : U -| \Delta_3}
%
\and
%
\Infer{wapp}
{\Delta_1; \Gamma |- e_2 : A -| \Delta_2\\\\
\Delta_2; \Gamma |- e_1 : \tyArr{A}{\wm}{U}  -| \Delta_3}
{\Delta_1, \wrtok; \Gamma |- \eApp{e_1}{e_2}{\wm} : U -| \Delta_3}
%
\and
%
\Infer{aapp}
{\Delta_1; \Gamma |- e_2 : X -| \Delta_2\\\\
\Delta_2; \Gamma |- e_1 : \tyArr{X}{1}{U} -| \Delta_3}
{\Delta_1; \Gamma |- \eApp{e_1}{e_2}{1} : U -| \Delta_3}
%
\and
%
\Infer{ufix}
{\emptyctxt; \Gamma,x : \tyArr{A}{\infty}{U} |- e : \tyArr{A}{\infty}{U} -| \emptyctxt}
{\Delta; \Gamma |- \eFixx{\infty}{x}{e} : \tyArr{A}{\infty}{U} -| \Delta}
%
\and
%
\Infer{wfix}
{\emptyctxt; \Gamma,x : \tyArr{A}{\wm}{U} |- e : \tyArr{A}{\wm}{U} -| \emptyctxt}
{\Delta; \Gamma |- \eFixx{\wm}{x}{e} : \tyArr{A}{\wm}{U} -| \Delta}
%
\and
%
\Infer{afix}
{x : \tyArr{X}{1}{U}; \Gamma |- e : \tyArr{X}{1}{U} -| \emptyctxt}
{\Delta; \Gamma |- \eFixx{1}{x}{e} : \tyArr{X}{1}{U} -| \Delta}
%
\and
%
\Infer{ulet}
{\Delta_1; \Gamma |- e_1 : A -| \Delta_2\\\\
\Delta_2; \Gamma, x:A |- e_2 : U -| \Delta_3}
{\Delta_1; \Gamma |- \eLett{\infty}{x}{e_1}{e_2} : U -| \Delta_3}
%
\and
%
\Infer{alet}
{\Delta_1; \Gamma |- e_1 : X -| \Delta_2\\\\
\Delta_2, x:X; \Gamma |- e_2 : U -| \Delta_3}
{\Delta_1; \Gamma |- \eLett{1}{x}{e_1}{e_2} : U -| \Delta_3 \div (x:X)}
%
\and
%
\Infer{bang}
{\Delta_1 ; \Gamma |- e : A -| \Delta_2}
{\Delta_1 ; \Gamma |- \eBang{e} : \tyBang{A} -| \Delta_2}
%
\and
%
\Infer{gnab}
{\Delta_1 ; \Gamma |- e : \tyBang{A} -| \Delta_2}
{\Delta_1 ; \Gamma |- \eUnbang{e} : A -| \Delta_2}
%
\and
%
\Infer{nu}
{\Delta_1, x_1: \tyRd{S} ; \Gamma, x_2 : \tyWr{S} |- e : U -| \Delta_2}
{\Delta_1; \Gamma |- \eNu{(x_1, x_2)}{e} : U -| \Delta_2 \div (x_1: \tyRd{S})}
%
\and
%
\Infer{wr}
{\Delta_1; \Gamma |- e_1 : S -| \Delta_2\\\\
\Delta_2; \Gamma |- e_2 : \tyWr{S} -| \Delta_3}
{\Delta_1, \wrtok; \Gamma|- \eWr{e_1}{e_2} : \tyUnit -| \Delta_3}
\end{mathpar}
\end{figure*}
\begin{figure*}[t]
\begin{mathpar}
\Infer{rd}
{\wrtok \not \in \Delta_2\\
\Delta_1 ; \Gamma |- e_1 : \tyRd{S} -| \Delta_2\\\\
\Delta_2,\wrtok, x : \tyTensor{\tyBang{S}}{\tyRd{S}} ; \Gamma |- e_2 : U -| \Delta_3}
{\Delta_1 ; \Gamma |- \eLetRd{e_1}{x}{e_2} : U -| \Delta_3 \div (\wrtok, x : \tyTensor{\tyBang{S}}{\tyRd{S}})}
%
\and
%
\Infer{choice}
{\wrtok \not \in \Delta_3 \\ 
\Delta_1 ; \Gamma |- e_1 : \tyRd{S} -| \Delta_2\\
\Delta_2 ; \Gamma |- e_2 : \tyRd{T} -| \Delta_3\\\\
\Delta_3, \wrtok, x_1 : \tyTensor{\tyBang{S}}{\tyTensor{\tyRd{S}}{\tyRd{T}}}; \Gamma |-
e_3 : U -| \Delta_4\\\\
\Delta_3, \wrtok, x_2 : \tyTensor{\tyBang{T}}{\tyTensor{\tyRd{S}}{\tyRd{T}}}; \Gamma |-
e_4 : U -| \Delta_4}
{\Delta_1; \Gamma |- \eChoicee{e_1}{x_1}{e_3}{e_2}{x_2}{e_4} : U -| \Delta_4~\div \\\\(\wrtok, x_1
  : \tyTensor{\tyBang{S}}{\tyTensor{\tyRd{S}}{\tyRd{T}}}, x_2 : \tyTensor{\tyBang{T}}{\tyTensor{\tyRd{T}}{\tyRd{S}}})}
%
\and
%
\Infer{fork}
{\Delta_1; \Gamma |- e_1 : U -| \Delta_2\\\\
\Delta_2; \Gamma |- e_2 : V -| \Delta_3}
{\Delta_1; \Gamma |- \eFork{e_1}{e_2} : V -| \Delta_3}
\end{mathpar}
\caption{Algorithmic typing rules.}
\label{fig:alg-typing}
\end{figure*}
