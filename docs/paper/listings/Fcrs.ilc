let fCrs crupt !toP frP !toQ frQ !toA frA k r =
  let pubref = ref Nothing in
  let replyCrs fr $\mathsf{to}$ = loop fr !(match @pubref with
			    | Nothing $=>$ let pub = samplePublicStrings D in
					  set pubref $\coloneqq$ Just pub ; wr pub $-> \mathsf{to}$
                            | Just pub $=>$ wr pub $-> \mathsf{to}$) in
      $\,$replyCrs frP toP
    $\xFork$ replyCrs frQ toQ
    $\xFork$ replyCrs frA toA