\section{UC Theory}
\label{sec:uc}

The type judgements do not guarantee termination, let alone polynomial time
normalization, so we define this additional notion.

\begin{definition}[Polynomial time normalization]
  Consider a term \textsf{e} that has the type
  \[\emptyctxt |- \mathsf{e} : \tyNat ->[\tyBit]\ {->}_m\ \tyBit,\]
  where the first argument is a security parameter \textsf{k} and the second
  argument is a random bitstring \textsf{r}. We say that \textsf{e} is
  polynomial time normalizable if for all random bitstrings \textsf{r}, where
  the length of \textsf{r} is polynomial in the security parameter \textsf{k},
  the term \textsf{e k r} normalizes to a value \textsf{v} in a polynomial (in
  \textsf{k}) number of steps.

  This definition applies similarly to a term of the type
  \[ \mathsf{k} : \tyNat, \mathsf{r} : [\tyBit] |- \mathsf{e} : \tyBit,\]
  where \textsf{k} and \textsf{r} are free variables in \textsf{e}.
\end{definition}

Because processes are confluent, we know that there is only one such value
\textsf{v = e k r} for each bitstring \textsf{r}, and that \textsf{e} is a
polynomial time computable function. Hence, a uniform distribution of bitstrings
gives us a distribution of \textsf{v} as $D_{\mathsf{e}}(\mathsf{v})$, which is
the probability that \textsf{e k r} normalizes to \textsf{v} for a particular
\textsf{k} and a uniform choice of \textsf{r}.

\begin{definition}[Polynomial time in UC]
  The judgement polyTimeUC is defined as 
  \begin{mathpar}
    \Infer{polyTimeUC}
    {\Delta ; \Gamma, k: \keyword{Int}, n:[\tyBit] |- \keyword{polyTime}(\keyword{execUC}(Z, \pi,
      A, F, k, r)) : \tyBit}
    {\Delta ; \Gamma |- \keyword{polyTimeUC}(Z, \pi, F, A)}
  \end{mathpar}
  where the length of $r$ is a polynomial $L(k)$ in $k$.
\end{definition}

We can now define emulation:

\begin{definition}[Protocol Emulation]
  The protocol-functionality pair $(\pi_0, \mc{F}_0)$ emulates $(\pi_1, \mc{F}_1)$
  if for all adversaries $\mc{A}$, there exists a simulator $\mc{S}_{\mc{A}}$
  such that for all environments $\mc{Z}$ such that $|- \keyword{polyTimeUC}(\mc{Z}, \pi_0,
  \mc{F}_0, \mc{A})$, then $|- \keyword{polyTimeUC}(Z, \pi_1, \mc{F}_1, \mc{S})$
  and
  \[ D(\mathsf{execUC} \mc{Z} \pi_0 \mc{F}_0 \mc{A}_0) \approx D(\mathsf{execUC} \mc{Z} \pi_1 \mc{F}_1 \mc{S})\]
\end{definition}

We can now state useful composition operators, simplifying lemmas, and
notation. For brevity, we pack several notions from UC into a single alternate
definition: UC-realizes.

\begin{definition}[UC-realizes]
  Protocol $\pi$ with $\mc{F}_0$ realizes $\mc{F}_1$, written $\mc{F}_0
  \yrightarrow{$\pi$} \mc{F}_1$, if for all environments $\mc{Z}$ such that $|-
  \keyword{polyTimeUC}(\mc{Z}, \pi, \mc{F}_0, \mathsf{dummyA})$, then
  $|- \keyword{polyTimeUC}(\mc{Z}, \mathsf{dummyP}, \mc{F}_1, \mc{S})$ and the
  distributions are statistically indistinguishable
  \[ D(\mathsf{execUC} \mc{Z} \pi \mc{F}_0 \mathsf{dummyA}) \approx D(\mathsf{execUC} \mc{Z} \mathsf{dummyP} \mc{F}_1 \mc{S})\]
\end{definition}

\begin{definition}[Composition]
  $\pi^{\phi}$ \todo{}
\end{definition}

\begin{theorem}[Composition Theorem]
  From UC-realizes, we can conclude the original UC formulation for arbitrary
  composition: If $\mc{F}_0 \yrightarrow{$\pi$} \mc{F}_1$, then for all $\phi$ we
  have that $(\phi^{\pi}, \mc{F}_0)$ emulates $(\phi, \mc{F}_1)$.
\end{theorem}

\begin{comment}
\subsection{Brain Dump}

\begin{definition}[Protocol Emulation]
Let $\pi$ and $\phi$ be probabilistic polynomial time (p.p.t) protocols. We say
that $\pi$ UC-emulates $\phi$ if for any p.p.t. adversary $\mc{A}$ there exists a
p.p.t. ideal-process adversary $\mc{S}$ such that for any balanced PPT environment
$\mc{Z}$ we have:
\begin{equation*}
\textsc{Exec}_{\phi, \mc{S}, \mc{Z}} \approx \textsc{Exec}_{\pi, \mc{A}, \mc{Z}}.
\end{equation*}
\end{definition}

\begin{lemma}[Protocol Emulation w.r.t. the Dummy Adversary]
Let $\pi$ and $\phi$ be probabilistic polynomial time (p.p.t) protocols. We say
that $\pi$ UC-emulates $\phi$ if for the dummy adversary $\mc{D}$ there exists a
p.p.t. ideal-process adversary $\mc{S}$ such that for any balanced PPT environment
$\mc{Z}$ we have:
\begin{equation*}
\textsc{Exec}_{\phi, \mc{S}, \mc{Z}} \approx \textsc{Exec}_{\pi, \mc{D}, \mc{Z}}.
\end{equation*}
\end{lemma}

\begin{theorem}[Universal Composition]
  Let $\rho$, $\pi$, and $\phi$, be p.p.t protocols such that $\pi$ UC-emulates $\phi$ and
  both $\phi$ and $\pi$ are subroutine respecting. Then protocol $\rho^{\phi -> \pi}$
  UC-emulates protocol $\rho$.
\end{theorem}

\begin{corollary}
  Let $\rho$, $\pi$ be p.p.t protocols such that $\pi$ UC-realizes a p.p.t ideal
  functionality $\mc{F}$, and both $\rho$ and $\pi$ are subroutine respecting. Then
  protocol $\rho^{\pi/\mc{F}}$ UC-emulates protocol $\rho$.
\end{corollary}

\begin{corollary}[Universal Composition: Realizing Functionalities]
  Let $\mc{F}$, $\mc{G}$ be ideal functionalities such that $\mc{F}$ is
  p.p.t. Let $\rho$ be a subroutine respecting protocol that UC-realizes $\mc{G}$,
  and let $\pi$ be a subroutine respecting protocol that UC-realizes
  $\mc{F}$. Then the composed protocol $\rho^{\pi/\mc{F}}$ securely realizes $\mc{G}$.
\end{corollary}

\begin{theorem}
  Protocol $\Pi_{\textsc{com}}$ securely realizes functionality
  $\Func_{\textsc{com}}$ in the CRS model.
\end{theorem}

Let {\sf Bit} be the type of single bits (i.e., 0 or 1), and let {\sf Inf} be
the type of infinite bitstrings. The meaning of an ILC term $\tau$ is given by the
denotation $[\![\tau]\!]\sigma$, which returns, for an infinite bitstring $\sigma{:}{\sf Inf}$, a value
$v{:}{\sf Bit}$. The denotation $[\![\tau]\!]$, then, returns a binary
distribution $d$ over the types of return values for all infinite
bitstrings. Let $\Delta(d_1, d_2)$ denote the statistical distance between two
distributions $d_1$ and $d_2$.
%\[ \Delta(d_1, d_2) \defeq max_{A}|d_1 A - d_2 A|\]

\begin{definition}[$\epsilon$-indistinguishability of ILC Terms]
Let $\tau_1$ and $\tau_2$ be ILC terms, which are closed except for an infinite
bitstream free variable $\sigma{:}{\sf Inf}$. Additionally, for any such $\sigma$,
$[\![t_1]\!]\sigma{:}{\sf Bit}$ and $[\![\tau_2]\!]\sigma{:}{\sf Bit}$. We say that $\tau_1$ and
$\tau_2$ are $\epsilon$-indistinguishable iff $\Delta([\![\tau_1]\!], [\![\tau_2]\!]) \leq \epsilon$.
\end{definition}

\begin{definition}[Probability Distribution Ensemble]
An \emph{ensemble} of probability distributions is a family of probability
distributions $\{ X_{\lambda, z} \}_{\lambda \in \mathbb{N}, z \in {\{0,1\}}^{*}}$ with index
set $\mathbb{N} \times \{0,1\}^{*}$.  The ensembles considered in this work are binary probability
distribution ensembles, which describe single bit outputs of computations, where
$\lambda \in \mathbb{N}$ represents the security parameter, and $z \in \{0,1\}^{*}$
represents input.
\end{definition}

\begin{definition}[Indistinguishability]
Let $X$ and $Y$ be two binary probability distribution
ensembles. We say that $X$ and $Y$ are indistinguishable
(written $X \approx Y$) if for any $c, d \in \mathbb{N}$, there exists
$\lambda_0 \in \mathbb{N}$ such that for all $\lambda > \lambda_0$ and all $z \in \cup_{\lambda \leq \lambda^d}\{0,1\}^{\lambda}$,
\[ | \Pr[X_{\lambda, z} = 1] - \Pr[Y_{\lambda, z} = 1] | < \lambda^{-c}. \]
\end{definition}

\begin{definition}[Bit Producing ILC Term]
Let $\tau$ be an ILC term. We say that $\tau$ is bit producing if it is closed except
for an infinite bitstream free variable $\sigma{:}{\sf Inf}$ and $\sigma{:}{\sf Inf} \vdash
\tau{:}{\sf Bit}$.
%security parameter in judgement
%and converging
\end{definition}

\noindent The denotation $[\![\tau]\!]\sigma$, in which a particular $\sigma$ is
given, evaluates to a value of type {\sf Bit}, and the denotation $[\![\tau]\!]$,
in which no $\sigma$ is specified, evaluates to a binary probability distribution
ensemble over types or values?

\begin{definition}[Indistinguishability of Bit Producing ILC Terms]
Let $\tau_1$ and $\tau_2$ be bit producing ILC terms. We say that $\tau_1$ and $\tau_2$ are
indistinguishable terms if the binary probability distribution ensembles
$[\![\tau_1]\!]$ and $[\![\tau_2]\!]$ are indistinguishable.
\end{definition}
%tau is an ILC+ stream w/ infinite streams and security parameter

\begin{definition}[Protocol Emulation in ILC]
Let $(\pi_1, \mc{F}_1)$ and $(\pi_2, \mc{F}_2)$ be two protocol-functionality
pairs. We say that $(\pi_1, \mc{F}_1)$ UC-emulates $(\pi_2, \mc{F}_2)$ iff for all
adversaries $\mc{A}$, there exists an ideal-process adversary $\mc{S}$ such that
for any environment $\mc{Z}$,
$\textsc{ExecUC}_{\mc{Z}, \mc{A}, \pi_1, \mc{F}_1}$ and
$\textsc{ExecUC}_{\mc{Z}, \mc{S}, \pi_2, \mc{F}_2}$ are bit producing and
indistinguishable terms.
% ExecUC should have sigma and parameter as free variables
% bit respecting adversaries and environments
% first define constraints pi and F for divergence wrt A and Z
\end{definition}

\begin{definition}[Protocol Emulation in ILC]
Let $\pi$ and $\phi$ be probabilistic polynomial time (p.p.t.) protocols. We say that
$\pi$ UC-emulates $\phi$ if for any p.p.t. adversary 
$\mc{A}$, there exists a p.p.t. ideal-process adversary $\mc{S}$
such that for any balanced p.p.t. environment $\mc{Z}$,
$\textsc{ExecUC}_{\phi, \mc{S}, \mc{Z}}$ and $\textsc{ExecUC}_{\pi, \mc{A}, \mc{Z}}$
are indistinguishable bit producing terms.
\end{definition}

\begin{definition}[Protocol Emulation in ILC]
Let $\pi$ and $\phi$ be protocols. We say that $\pi$ UC-emulates $\phi$ iff for all
adversaries $\mc{A}$, there exists an ideal-process adversary $\mc{S}$ such that
for any environment $\mc{Z}$,
$\textsc{ExecUC}[\pi, \mc{A}, \mc{Z}, \lambda, \sigma]$ and
$\textsc{ExecUC}[\phi, \mc{S}, \mc{Z}, \lambda, \sigma]$ are bit producing and
indistinguishable terms.
\end{definition}

\begin{definition}[Balanced Environment]
An environment $\mc{Z}$ is balanced if the overall length of inputs given by
$\mc{Z}$ to the parties of the main instance $\pi$ is at most $k$ times the length
of the input to the adversary.
\end{definition}

Environment should activate the adversary to allow sending of messages.
\end{comment}
