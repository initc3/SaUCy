\begin{figure*}[htbp]
\centering
\judgbox{\Delta ; \Gamma |- e : A |> m}{~~Under $\Delta$ and $\Gamma$, expression~$e$ has type $A$ and mode $m$.}
\begin{mathpar}
\Infer{var}
{\Gamma(x) = A}
{\Delta; \Gamma |- x: A}
%
\and
%
\Infer{lvar}
{\Delta(x) = A}
{\Delta; \Gamma |- x: A}
%
\and
%
\Infer{unit}
{ }
{\Delta ; \Gamma |- \vUnit : \tyUnit}
%
\and
%
\Infer{pair}
{\Delta_1; \Gamma |- e_1 : A_1\\\\
\Delta_2; \Gamma |- e_2 : A_2}
{\Delta_1, \Delta_2; \Gamma |- (e_1, e_2) : A_1 \times A_2}
%
\and
%
\Infer{inj}
{i \in \{1, 2\}\\\\
\Delta; \Gamma |- e : A_i}
{\Delta ; \Gamma |- \vInj{i}{e}  : A_1 + A_2}
%
\and
%
\Infer{ref}
{\Delta; \Gamma |- e : A}
{\Delta; \Gamma |- \Ref{e} : A\ \textsf{ref}}
%
\and
%
\Infer{thunk}
{\Delta; \Gamma |- e : A |> m}
{\Delta; \Gamma |- \thunk{e} : \tyUp{A ** m}}
%
\and
%
\Infer{split}
{\Delta_1; \Gamma |- e_1 : A_1 \times A_2\\\\
\Delta_2; \Gamma,x_1:A_1, x_2:A_2 |- e_2 : B |> m}
{\Delta_1, \Delta_2; \Gamma |- \Split{e_1}{x_1}{x_2}{e_2} : B |> m}
%
\and
%
\Infer{case}
{\Delta_1; \Gamma |- e : A_1 + A_2\\\\
\Delta_2; \Gamma,x_1:A_1 |- e_1 : B |> m\\\\
\Delta_2; \Gamma,x_2:A_2 |- e_2 : B |> m}
{\Delta_1, \Delta_2; \Gamma |- \Case{e}{x_1}{e_1}{x_2}{e_2} : B |> m}
%
\and
%
\Infer{get}
{\Delta; \Gamma |- e : A\ \textsf{ref}}
{\Delta; \Gamma |- \Get{e} : A}
%
\and
%
\Infer{set}
{\Delta_1, \Gamma |- e_1 : A\ \textsf{ref} \\ \Delta_2, \Gamma |- e_2 : A }
{\Delta_1, \Delta_2; \Gamma |- \Set{e_1}{e_2} : \tyUnit}
%
\and
%
\Infer{force}
{\Delta; \Gamma |- e : \tyUp{A, m}}
{\Delta; \Gamma |- \eForce{e} : A |> m}
%
\and
%
\Infer{fix}
{\Delta; \Gamma |- e : A -> A |> m}
{\Delta; \Gamma |- \eFix{e} : A |> m}

%
\and
%
\Infer{let}
{m_1 ;; m_2 => m_3\\\\
\Delta_1 ; \Gamma |- e_1 : A |> m_1 \\
\Delta_2 ; \Gamma, x:A |- e_2 : B |> m_2
}
{\Delta_1, \Delta_2 ; \Gamma |- \Let{e_1}{x}{e_2} : B |> m_3}
%
\and
%
\Infer{let!}
{\Delta_1 ; \Gamma |- v : *! A\\\\
\Delta_2 ; \Gamma, x:A |- e : B |> m}
{\Delta_1, \Delta_2 ; \Gamma |- \LetBang{v}{x}{e} : B |> m}
%
\and
%
\Infer{lam}
{\Delta ; \Gamma, x:A |- e : B |> m}
{\Delta ; \Gamma |- \lam{x} e : A -> B |> m}
%
\and
%
\Infer{app}
{\Delta_1 ; \Gamma |- e_2 : A\\\\
\Delta_2 ; \Gamma |- e_1 : A -> B |> m}
{\Delta_1, \Delta_2 ; \Gamma |- e_1 e_2 : B |> m}
%
\and
%
\Infer{nu}
{\Delta, x_1:\tyRd A; \Gamma, x_2:\tyWr A |- e : B |> m}
{\Delta ; \Gamma |- \eNu{(x_1, x_2)}{e} : B |> m}
%
\and
%
\Infer{wr}
{\Delta_1; \Gamma   |- e_1 : A\\\\
\Delta_2; \Gamma   |- e_2 : \tyWr{A}}
{\Delta_1, \Delta_2; \Gamma |- \eWr{e_1}{e_2} : \tyUnit |> \Wm}
%
\and
%
\Infer{rd}
{\Delta; \Gamma |- e : \tyRd A}
{\Delta; \Gamma |- \eRd{e} : (A \times \tyRd A) |> \Rm}
%
\and
%
\Infer{fork}
{m_1 || m_2 => m_3\\\\
\Delta_1; \Gamma |- e_1 : A |> m_1\\
\Delta_2; \Gamma |- e_2 : B |> m_2}
{\Delta_1, \Delta_2; \Gamma |- e_1 \xFork e_2 : B |> m_3}
%
\and
%
\Infer{choice}
{\Delta_1; \Gamma |- e_1 : A |> \Rm\\\\
\Delta_2; \Gamma |- e_2 : A |> \Rm
}
{\Delta_1, \Delta_2; \Gamma |- e_1 *|| e_2 : A |> \Rm}
%
\and
%
\Infer{seq}
{m_1 ;; m_2 => m_3\\\\
\Delta_1; \Gamma |- e_1 : A |> m_1\\
\Delta_2; \Gamma |- e_2 : B |> m_2}
{\Delta_1, \Delta_2; \Gamma |- e_1 ; e_2 : B |> m_3}
\end{mathpar}
\caption{Expression typing.}
\label{fig:type-expressions}
\end{figure*}
