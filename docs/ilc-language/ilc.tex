\def\OPTIONConf{0}%
\def\OPTIONArxiv{0}%
%
\documentclass[10pt]{article}
\input{defs}

\begin{document}

\title{Interactive Lambda Calculus (ILC) Language Definition}
\author{Kevin Liao\textsuperscript{\textasteriskcentered},
        Matthew Hammer\textsuperscript{\textdagger},
        Andrew Miller\textsuperscript{\textasteriskcentered}}
\date{\textsuperscript{\textasteriskcentered} University of Illinois,
  Urbana-Champaign \hspace{0.5cm} \textsuperscript{\textdagger} University of
  Colorado Boulder}

\maketitle
\thispagestyle{empty}

\begin{figure}[htbp]
  \centering

\begin{grammar}
  Value Types
  & $A,B$
      &$\bnfas$&
      $x$ & Value variable
      \\ &&& $\bnfaltbrk \vUnit$ & Unit value
      \\ &&& $\bnfaltbrk \tyNat$         & Natural number
      \\ &&& $\bnfaltbrk A ** B$ & Product
      \\ &&& $\bnfaltbrk A + B$ & Sum type
      \\ &&& $\bnfaltbrk *! A$ & Intuitionistic type
      \\ &&& $\bnfaltbrk \tyRd{A}$ & Read channel
      \\ &&& $\bnfaltbrk \tyWr{A}$ & Write channel
      \\ &&& $\bnfaltbrk \tyU{C}$ & Thunk type
  \\[1ex]
  Computation Types
  & $C, D$
      &$\bnfas$ & 
             $A -> C$ & Value-consuming computation
      \\ &&& $\bnfaltbrk \tyF{A}$ & Value-producing computation
  \\[1ex]
  Linear Typing Contexts
  & $\Delta$
     &$\bnfas$& $\emptyctxt \bnfalt \Delta,x:A$
  \\
  Intuitionisitic Typing Contexts
  & $\Gamma$
     &$\bnfas$& $\emptyctxt \bnfalt \Gamma,x:A$
\end{grammar}

  \caption{Syntax of types and typing contexts}
  \label{fig:expr}
\end{figure}


\begin{figure}[htbp]
  \centering

\begin{grammar}
  Values
  & $v$
      &$\bnfas$&
      $x$
      \\ &&& $\bnfaltbrk \vUnit$ & Unit value
      \\ &&& $\bnfaltbrk n$         & Natural number
      \\ &&& $\bnfaltbrk \vPair{v_1}{v_2}$ & Pair of values
      \\ &&& $\bnfaltbrk \vInj{i}{v}$ & Injected value
      \\ &&& $\bnfaltbrk \vChan{c}$ & Channel (either read or write end)
      \\ &&& $\bnfaltbrk \vThunk{e}$ & Thunk (suspended, closed expression)
  \\[1ex]
  Expressions
  & $e$
      &$\bnfas$&
             $\Split{v}{x_1}{x_2}{e}$ & Pair elimination
      \\ &&& $\bnfaltbrk \Case{v}{x_1}{e_1}{x_2}{e_2}$ & Injection elimination
      \\ &&& $\bnfaltbrk \Ret{v}$ & Value-producing computation
      \\ &&& $\bnfaltbrk \Let{e_1}{x}{e_2}$ & Let-binding/sequencing
      \\ &&& $\bnfaltbrk \eApp{e}{v}$ & Function application
      \\ &&& $\bnfaltbrk \lam{x} e$ & Function abstraction
      \\ &&& $\bnfaltbrk \eForce{v}$ & Unsuspend (force) a thunk
      \\ &&& $\bnfaltbrk \eWr{v_1}{v_2}$ & Write channel~$v_1$ with value~$v_2$
      \\ &&& $\bnfaltbrk \eRd{v}$ & Read channel~$v$
      \\ &&& $\bnfaltbrk \eNu{x}{e}$ & Allocate channel as~$x$ in~$e$      \\ &&& $\bnfaltbrk e_1 *&& e_2$ & Fork~$e_1$, continue as~$e_2$
      \\ &&& $\bnfaltbrk e_1 *|| e_2$ & External choice between~$e_1$ and~$e_2$
\end{grammar}

  \caption{Syntax of values and expressions}
  \label{fig:expr}
\end{figure}

\begin{figure}[htbp]
{
  \centering

\begin{grammar}
  Modes & $m,n,p$ &$\bnfas$& $\Wm \bnfalt \Rm \bnfalt \Vm$ & (Write, Read and Value) 
\end{grammar}

\judgbox{m || n => p}{~~The parallel composition of modes $m$ and $n$ is mode~$p$.}
\begin{mathpar}
\Infer{sym}{m || n => p}{n || m => p}
\and \Infer{wv}{ }{\Wm || \Vm => \Wm}
\and \Infer{wr}{ }{\Wm || \Rm => \Wm}
\and \Infer{rr}{ }{\Rm || \Rm => \Rm}
\end{mathpar}
\\[2mm]
\judgbox{m ;; n => p}{~~The sequential composition of modes $m$ and $n$ is mode~$p$.}
\begin{mathpar}
\and \Infer{v$\ast$}{ }{\Vm ;; n => n}
\and \Infer{wv}{ }{\Wm ;; \Vm => \Wm}
\and \Infer{r$\ast$}{ }{\Rm ;; n => \Rm}
\and \Infer{wr}{ }{\Wm ;; \Rm => \Wm}
\end{mathpar}
}
Note that in particular, the following mode compositions are \emph{not derivable}:
\begin{itemize}
\item $\Wm || \Wm => p$ is \emph{not} derivable for any mode~$p$
\item $\Wm ;; \Wm => p$ is \emph{not} derivable for any mode~$p$
\end{itemize}
\caption{Syntax of modes; sequential and parallel mode composition.}
\label{fig:expr}
\end{figure}

\begin{figure}[htbp]
\centering
\judgbox{\Delta ; \Gamma |- v : S |> m}{~~Under $\Delta$ and $\Gamma$, value~$v$ has type scheme $S$ and mode $m$.}
\begin{mathpar}
%
\Infer{var}
{\Delta; \Gamma(x) = S}
{\Delta; \Gamma |- x: S}
%
\and
%
\Infer{lvar?}
{\Delta(x) = S; \Gamma}
{\Delta; \Gamma |- x: S}
%
\and
%
\Infer{unit}
{ }
{\Delta ; \Gamma |- \vUnit : \tyUnit}
%
\and
%
\Infer{inj}
{i \in \{1, 2\}\\\\
\Delta; \Gamma |- v : V_i}
{\Delta ; \Gamma |- \vInj{i}{v}  : V_1 + V_2}
%
\and
%
\Infer{pair}
{\Delta_1; \Gamma |- v_1 : V_1\\\\
\Delta_2; \Gamma |- v_2 : V_2}
{\Delta_1, \Delta_2; \Gamma |- (v_1, v_2) : V_1 \times V_2}
%
\and
%
\Infer{thunk}
{\Delta; \Gamma |- e : C |> m}
{\Delta; \Gamma |- \thunk{e} : \tyUp{C, m}}
%
\and
%
\Infer{ref}
{\Delta; \Gamma |- v : A}
{\Delta; \Gamma |- \Ref{v} : \tyM{A}}
\end{mathpar}
\end{figure}

\begin{figure}[htbp]
\centering
\judgbox{\Delta ; \Gamma |- e : S |> m}{~~Under $\Delta$ and $\Gamma$, expression~$e$ has type scheme $S$ and mode $m$.}
\begin{mathpar}
\Infer{inst}
{\Delta; \Gamma |- e : S_1 |> m\\
S_1 \sqsubseteq S_2}
{\Delta; \Gamma |- e : S_2 |> m}
%
\and
%
\Infer{gen}
{\Delta; \Gamma |- e : S |> m\\
\overline{a} \not \in \ftv{\Gamma}}
{\Delta; \Gamma |- e : \forall\overline{a} . S}
%
\and
%
\Infer{ret}
{\Delta; \Gamma |- v : A}
{\Delta; \Gamma|- \Ret{v} : \tyF{A} |> \Vm}
%
\and
%
\Infer{ret!}
{\emptyctxt ; \Gamma |- v : A}
{\emptyctxt ; \Gamma |- \Ret{v} : \tyF (*! A) |> \Vm}
%
\and
%
\Infer{let}
{m_1 ;; m_2 => m_3\\\\
\Delta_1 ; \Gamma |- e_1 : S |> m_1 \\\\
\Delta_2 ; \Gamma, x:S |- e_2 : C |> m_2
}
{\Delta_1, \Delta_2 ; \Gamma |- \Let{e_1}{x}{e_2} : C |> m_3}
%
\and
%
\Infer{let!}
{\Delta_1 ; \Gamma |- v : *! S\\\\
\Delta_2 ; \Gamma, x:S |- e : C |> m}
{\Delta_1, \Delta_2 ; \Gamma |- \LetBang{v}{x}{e} : C |> m}
%
\and
%
\Infer{lam}
{\Delta ; \Gamma, x:A |- e : C |> m}
{\Delta ; \Gamma |- \lam{x} e : A -> C |> m}
%
\and
%
\Infer{app}
{\Delta_1 ; \Gamma |- v : A\\\\
\Delta_2 ; \Gamma |- e : A -> C |> m}
{\Delta_1, \Delta_2 ; \Gamma |- e v : C |> m}
%
\and
%
\Infer{fix?}
{\Delta; \Gamma, f:C |- e : C |> m}
{\Delta; \Gamma |- \fix{f}{e} : C |> m}
%
\and
%
\Infer{nu}
{\Delta, x:\big(\tyRd A ** *!(\tyWr A)\big) ; \Gamma |- e : C |> m}
{\Delta                                 ; \Gamma |- \eNu{x}{e} : C |> m}
%
\and
%
\Infer{rd}
{\Delta; \Gamma |- e : \tyRd A}
{\Delta; \Gamma |- \eRd{e} : (A \times \tyRd A) |> \Rm}
%
\and
%
\Infer{wr}
{\Delta_1; \Gamma   |- v_1 : \tyWr{A}\\\\
\Delta_2; \Gamma   |- v_2 : A}
{\Delta_1, \Delta_2; \Gamma |- \eWr{v_1}{v_2} : \tyUnit |> \Wm}
%
\and
%
\Infer{fork}
{m_1 || m_2 => m_3\\\\
\Delta_1; \Gamma |- e_1 : C |> m_1\\\\
\Delta_2; \Gamma |- e_2 : D |> m_2}
{\Delta_1, \Delta_2; \Gamma |- e_1 \xFork e_2 : D |> m_3}
%
\and
%
\Infer{choice}
{\Delta_1; \Gamma |- e_1 : C |> \Rm\\\\
\Delta_2; \Gamma |- e_2 : C |> \Rm
}
{\Delta_1, \Delta_2; \Gamma |- \eChoose{e_1, e_2} : C |> \Rm}
%
\and
%
\Infer{seq}
{m_1 ;; m_2 => m_3\\\\
\Delta_1; \Gamma |- e_1 : C |> m_1\\\\
\Delta_2; \Gamma |- e_2 : D |> m_2}
{\Delta_1, \Delta_2; \Gamma |- \Seq{e_1}{e_2} : D |> m_3}
%
\and
%
\Infer{if}
{m_1 ;; m_2 => m_3\\\\
\Delta_1; \Gamma |- e_1 : \tyBool |> m_1\\\\
\Delta_2; \Gamma |- e_2 : C |> m_2\\\\
\Delta_2; \Gamma |- e_3 : C |> m_2}
{\Delta_1, \Delta_2; \Gamma |- \If{e_1}{e_2}{e_3} : C |> m_3}
%
\and
%
\Infer{if?}
{\Delta_1; \Gamma |- v : \tyBool\\\\
\Delta_2; \Gamma |- e_1 : C |> m\\\\
\Delta_2; \Gamma |- e_2 : C |> m}
{\Delta_1, \Delta_2; \Gamma |- \If{v}{e_1}{e_2} : C |> m}
%
\and
%
\Infer{case}
{\Delta_1; \Gamma |- v : A_1 + A_2\\\\
\Delta_2; \Gamma,x_1:A_1 |- e_1 : C |> m\\\\
\Delta_2; \Gamma,x_2:A_2 |- e_2 : C |> m}
{\Delta_1, \Delta_2; \Gamma |- \Case{v}{x_1}{e_1}{x_2}{e_2} : C |> m}
%
\and
%
\Infer{split}
{\Delta_1; \Gamma |- v : A_1 \times A_2\\\\
\Delta_2; \Gamma,x_1:A_1, x_2:A_2 |- e : C |> m}
{\Delta_1, \Delta_2; \Gamma |- \Split{v}{x_1}{x_2}{e} : C |> m}
%
\and
%
\Infer{force}
{\Delta; \Gamma |- v : \tyUp{C, m}}
{\Delta; \Gamma |- \eForce{v} : C |> m}
%
\and
%
\Infer{get}
{\Delta; \Gamma |- v : \tyM{A}}
{\Delta; \Gamma |- \Get{v} : A}
%
\and
%
\Infer{set}
{\Delta, \Gamma, x: \tyM{S} |- v : S}
{\Delta; \Gamma |- \Set{x}{v} : \tyUnit}
\end{mathpar}
\end{figure}

\begin{figure}[htbp]
\centering
\judgbox{\Delta_{in} ; \Gamma_{in} |- v : S => \Delta_{out}; \Gamma_{out}}{~~Under $\Delta_{in}$ and
$\Gamma_{in}$, value~$v$ has type scheme $S$ and returns $\Delta_{out}$ and $\Gamma_{out}$.}
\begin{mathpar}
%
\Infer{a-var}
{ }
{\Delta; \Gamma_1, x:S, \Gamma_2 |- x: S => \Delta; \Gamma_1, x:S, \Gamma_2}
%
\and
%
\Infer{a-lvar}
{ }
{\Delta_1, x:S, \Delta_2; \Gamma |- x: S => \Delta_1, \Delta_2 ; \Gamma}
%
\and
%
\Infer{a-unit}
{ }
{\Delta ; \Gamma |- \vUnit : \tyUnit => \Delta ; \Gamma}
%
\and
%
\Infer{a-inj}
{i \in \{1, 2\}\\\\
\Delta_1; \Gamma_1 |- v : V_i => \Delta_2; \Gamma_2}
{\Delta_1 ; \Gamma_1 |- \vInj{i}{v}  : V_1 + V_2 => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-pair}
{\Delta_1; \Gamma_1 |- v_1 : V_1 => \Delta_2 ; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- v_2 : V_2 => \Delta_3 ; \Gamma_3}
{\Delta_1; \Gamma_1 |- (v_1, v_2) : V_1 \times V_2 => \Delta_3 ; \Gamma_3}
%
\and
%
\Infer{a-thunk}
{\Delta; \Gamma |- e : C => \Delta; \Gamma}
{\Delta; \Gamma |- \thunk{e} : \tyUp{C, m} => \Delta ; \Gamma}
%
\and
%
\Infer{a-ref}
{\Delta_1; \Gamma_1 |- v : A => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \Ref{v} : \tyM{A} => \Delta_2; \Gamma_2}
\end{mathpar}
\end{figure}

\begin{figure}[htbp]
\centering
\judgbox{\Delta_{in} ; \Gamma_{in} |- e : S => \Delta_{out}; \Gamma_{out}}{~~Under $\Delta_{in}$ and
$\Gamma_{in}$, expression~$e$ has type scheme $S$ and returns $\Delta_{out}$ and $\Gamma_{out}$.}
\begin{mathpar}
\Infer{a-inst?}
{\Delta; \Gamma |- e : S_1 => \Delta; \Gamma\\
S_1 \sqsubseteq S_2}
{\Delta; \Gamma |- e : S_2 => \Delta; \Gamma}
%
\and
%
\Infer{a-gen?}
{\Delta; \Gamma |- e : S => \Delta; \Gamma\\
\overline{a} \not \in \ftv{\Gamma}}
{\Delta; \Gamma |- e : \forall\overline{a} . S => \Delta; \Gamma}
%
\and
%
\Infer{a-ret}
{\Delta_1; \Gamma_1 |- v : A => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \Ret{v} : \tyF{A} => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-ret!?}
{\emptyctxt ; \Gamma |- v : A}
{\emptyctxt ; \Gamma |- \Ret{v} : \tyF (*! A) => \emptyctxt ; \Gamma}
%
\and
%
\Infer{a-let?}
{\Delta_1; \Gamma_1 |- e_1 : S => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2, x:S |- e_2 : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \Let{e_1}{x}{e_2} : C => \Delta_3; \Gamma_3 \div (x:S)}
%
\and
%
\Infer{a-let!?}
{\Delta_1; \Gamma_1 |- v : *! S => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2, x:S |- e : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \LetBang{v}{x}{e} : C => \Delta_3; \Gamma_3 \div (x:S)}
%
\and
%
\Infer{a-lam}
{\Delta_1 ; \Gamma_1, x:A |- e : C => \Delta_2; \Gamma_2}
{\Delta_1 ; \Gamma_1 |- \lam{x} e : A -> C => \Delta_2; \Gamma_2 \div (x:A))}
%
\and
%
\Infer{a-app}
{\Delta_1; \Gamma_1 |- v : A => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- e : A -> C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- e v : C => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-fix?}
{\Delta_1; \Gamma_1, f:C |- e : C => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \fix{f}{e} : C => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-nu?}
{\Delta_1, x:\big(\tyRd A ** *!(\tyWr A)\big); \Gamma_1 |- e : C => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \eNu{x}{e} : C => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-rd}
{\Delta_1; \Gamma_1 |- e : \tyRd A => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \eRd{e} : (A \times \tyRd A) => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-wr}
{\Delta_1; \Gamma_1 |- v_1 : \tyWr{A} => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- v_2 : A => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1|- \eWr{v_1}{v_2} : \tyUnit => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-fork}
{\Delta_1 \setminus \Delta_2 \subseteq \Delta_3\\\\
\Delta_1 \setminus \Delta_3 \subseteq \Delta_2\\\\
\Delta_1; \Gamma_1 |- e_1 : C => \Delta_2; \Gamma_2\\\\
\Delta_1; \Gamma_1 |- e_2 : D => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- e_1 \xFork e_2 : D => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-choice?}
{\Delta_1; \Gamma_1 |- e_1 : C => \Delta_2; \Gamma_2\\\\
\Delta_1; \Gamma_1 |- e_2 : C => \Delta_2; \Gamma_2
}
{\Delta_1; \Gamma_1 |- \eChoose{e_1, e_2} : C => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-seq}
{\Delta_1; \Gamma_1 |- e_1 : C => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- e_2 : D => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \Seq{e_1}{e_2} : D => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-if?}
{\Delta_1; \Gamma_1 |- e_1 : \tyBool => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- e_2 : C => \Delta_3; \Gamma_3\\\\
\Delta_2; \Gamma_2 |- e_3 : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \If{e_1}{e_2}{e_3} : C => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-if?}
{\Delta_1; \Gamma_1 |- v : \tyBool => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2 |- e_1 : C => \Delta_3; \Gamma_3\\\\
\Delta_2; \Gamma_2 |- e_2 : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \If{v}{e_1}{e_2} : C => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-case?}
{\Delta_1; \Gamma_1 |- v : A_1 + A_2 => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2,x_1:A_1 |- e_1 : C => \Delta_3; \Gamma_3\\\\
\Delta_2; \Gamma_2,x_2:A_2 |- e_2 : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \Case{v}{x_1}{e_1}{x_2}{e_2} : C => \Delta_3; \Gamma_3 \div (x_i:A_i)}
%
\and
%
\Infer{a-split?}
{\Delta_1; \Gamma_1 |- v : A_1 \times A_2 => \Delta_2; \Gamma_2\\\\
\Delta_2; \Gamma_2,x_1:A_1, x_2:A_2 |- e : C => \Delta_3; \Gamma_3}
{\Delta_1; \Gamma_1 |- \Split{v}{x_1}{x_2}{e} : C => \Delta_3; \Gamma_3}
%
\and
%
\Infer{a-force?}
{\Delta_1; \Gamma_1 |- v : \tyUp{C, m} => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \eForce{v} : C => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-get?}
{\Delta_1; \Gamma_1 |- v : \tyM{A} => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \Get{v} : A => \Delta_2; \Gamma_2}
%
\and
%
\Infer{a-set?}
{\Delta_1, \Gamma_1, x: \tyM{S} |- v : S => \Delta_2; \Gamma_2}
{\Delta_1; \Gamma_1 |- \Set{x}{v} : \tyUnit => \Delta_2; \Gamma_2}
\end{mathpar}
\end{figure}

\bibliographystyle{unsrt}
\bibliography{references}

\end{document}
